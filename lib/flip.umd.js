(function(n,a){typeof exports=="object"&&typeof module<"u"?a(exports):typeof define=="function"&&define.amd?define(["exports"],a):(n=typeof globalThis<"u"?globalThis:n||self,a(n.Flip={}))})(this,function(n){"use strict";class a{runAnimate(t){const e=i=>{this.last(),this.invert(),this.play(i)};if(t&&typeof t=="function")e(t);else return new Promise(e)}}const r=new WeakSet;class h extends a{constructor(t,e=300,i=[]){if(r.has(t))throw new Error("Element has been registered");r.add(t),super(),this.isRunning=!1,this.el=t,this.animateOption=e,this.otherStyleKeys=i,this.init()}getRect(){const t=getComputedStyle(this.el),e=t.transform;this.el.style.transform="none";const i=this.el.getBoundingClientRect();this.el.style.transform=e;const s=i.top,l=i.left,f={};for(const o of this.otherStyleKeys)o!=="transform"&&(f[o]=t[o]);return{top:s,left:l,transform:e==="none"?"":e,styles:f}}init(){this.firstRect=this.getRect()}last(){this.lastRect=this.getRect()}invert(){const{left:t,top:e,transform:i,styles:s}=this.firstRect,{left:l,top:f,transform:o,styles:c}=this.lastRect,u=t-l,y=e-f;this.firstAnimateKeyframe={...s,transform:`translateX(${u}px) translateY(${y}px) ${i}`},this.lastAnimateKeyframe={...c,transform:o}}play(t){if(!r.has(this.el))throw new Error("Flip instance has been destroyed");if(this.isRunning)return;this.isRunning=!0;const e=this.el.animate([this.firstAnimateKeyframe,this.lastAnimateKeyframe],this.animateOption);this.animation=e,e.addEventListener("finish",()=>{this.isRunning=!1,t(),this.firstRect=this.lastRect,this.lastRect=void 0,this.firstAnimateKeyframe=void 0,this.lastAnimateKeyframe=void 0,this.animation=void 0})}animate(t,e){const[i,s]=this.animateFuncParamsMerge(t,e);return i&&(this.animateOption=i),super.runAnimate(s)}animateFuncParamsMerge(t,e){if(typeof t=="function")return[e,t];if(t&&(typeof t=="number"||typeof t=="object"))return[t,void 0];if(t)throw new Error("Invalid animate params");return[void 0,void 0]}pause(){this.animation&&this.animation.pause()}resume(){this.animation&&this.animation.play()}destroy(){this.animation&&this.animation.cancel(),r.delete(this.el),this.el=this.animateOption=this.otherStyleKeys=this.firstRect=this.lastRect=this.firstAnimateKeyframe=this.lastAnimateKeyframe=this.animation=void 0}}n.Flip=h,Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})});
