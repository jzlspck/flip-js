(function(n,o){typeof exports=="object"&&typeof module<"u"?o(exports):typeof define=="function"&&define.amd?define(["exports"],o):(n=typeof globalThis<"u"?globalThis:n||self,o(n.Flip={}))})(this,function(n){"use strict";class o{runAnimate(t){const e=i=>{this.last(),this.invert(),this.play(i)};if(t&&typeof t=="function")e(t);else return new Promise(e)}}const f=new WeakSet;class h extends o{constructor(t,e=300,i=[]){if(f.has(t))throw new Error("Element has been registered");f.add(t),super(),this.isRunning=!1,this.el=t,this.animateOption=e,this.otherStyleKeys=i,this.init()}getRect(){const t=getComputedStyle(this.el),e=t.transform;this.el.style.transform="none";const i=this.el.getBoundingClientRect();this.el.style.transform=e;const s=i.top,a=i.left,l={};for(const r of this.otherStyleKeys)r!=="transform"&&(l[r]=t[r]);return{top:s,left:a,transform:e==="none"?"":e,styles:l}}init(){this.firstRect=this.getRect()}last(){this.lastRect=this.getRect()}invert(){const{left:t,top:e,transform:i,styles:s}=this.firstRect,{left:a,top:l,transform:r,styles:p}=this.lastRect,u=t-a,y=e-l;this.firstAnimateKeyframe={...s,transform:`translateX(${u}px) translateY(${y}px) ${i}`},this.lastAnimateKeyframe={...p,transform:r}}play(t){if(!f.has(this.el))throw new Error("Flip instance has been destroyed");if(this.isRunning)return;this.isRunning=!0;const e=this.el.animate([this.firstAnimateKeyframe,this.lastAnimateKeyframe],this.animateOption);this.animation=e,e.addEventListener("finish",()=>{this.isRunning=!1,t(),this.firstRect=this.lastRect,this.lastRect=void 0,this.firstAnimateKeyframe=void 0,this.lastAnimateKeyframe=void 0,this.animation=void 0})}animate(t,e){const[i,s]=this.animateFuncParamsMerge(t,e);return i&&(this.animateOption=i),super.runAnimate(s)}animateFuncParamsMerge(t,e){if(typeof t=="function")return[e,t];if(t&&(typeof t=="number"||typeof t=="object"))return[t,void 0];if(t)throw new Error("Invalid animate params");return[void 0,void 0]}pause(){this.animation&&this.animation.pause()}resume(){this.animation&&this.animation.play()}destroy(){this.animation&&this.animation.cancel(),f.delete(this.el),this.el=this.animateOption=this.otherStyleKeys=this.firstRect=this.lastRect=this.firstAnimateKeyframe=this.lastAnimateKeyframe=this.animation=void 0}}class m{constructor(t,e,i=[]){if(this.flips=[],t instanceof HTMLElement)this.flips=[new h(t,e,i)];else if(t instanceof NodeList||t instanceof HTMLCollection||Array.isArray(t))new Set(Array.from(t)).forEach(a=>{this.flips.push(new h(a,e,i))});else throw new Error("FlipFactory: el must be HTMLElement or HTMLElement[] or NodeList or HTMLCollection")}animate(t,e){if(typeof t=="function")this.flips.forEach(i=>i.animate(t,e));else return new Promise(i=>{Promise.all(this.flips.map(s=>s.animate(t))).then(()=>i())})}pause(){this.flips.forEach(t=>t.pause())}resume(){this.flips.forEach(t=>t.resume())}destroy(){this.flips.forEach(t=>t.destroy()),this.flips=[]}}n.Flip=m,Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})});
